---
layout: post
title: '쿠버네티스 구조와 구성요소에 대해 한번 알아보자'
categories: kubernetes
comments: false
---

### 쿠버네티스란? 
도커와 같은 컨테이너 기술을 사용하기 위해선 이들을 쉽게 관리할 수 있도록 도와주는 도구가 필요합니다. 가장 널리 알려지고 사용중인 쿠버네티스는 구글에서 개발된 컨테이너 오케스트레이션 도구입니다. 컨테이너를 관리하기 쉽게 도와주는 컨테이너 관리 플랫폼으로 애플리케이션 배포 및 운영 자동화를 하는데 도움을 줍니다. 쿠버네티스는 docker, containerd, cri-o, rktlet 등 여러 컨테이너 기술을 지원하고 있습니다.

### 쿠버네티스가 제공하는 기능들
쿠버네티스는 기본적으로 컨테이너를 실행할 수 있는 공간인 노드 클러스터를 제공해 줍니다. 노드(Node)란 하나의 물리적인 호스트를 말하는데 여러 호스트가 하나의 클러스터를 이루게 됩니다. 같은 클러스터 내부에서 다수의 컨테이너들이 생생, 관리되며 서로 상호작용 할 수 있습니다. 
쿠버네티스 내에서 컨테이너가 실행될 때는 파드(Pod)라는 단위로 실행되게 되는데, 파드란 컨테이너들의 집합이라고 보시면 됩니다. 사용자가 만든 애플리케이션 외에 초기화에 필요한 컨테이너들이 하나의 파드에 포함되게 되고 파드 내에서 컨테이너들은 같은 네트워크 IP를 공유하게 됩니다.
그 외, 쿠버네티스는 원하는 스토리지 시스템을 마운트하고, DNS 명이나 IP 주소 등을 통해 컨테이너를 클러스터 외부로 노출하거나 트래픽에 대한 로드밸런싱을 지원합니다. 그리고 특정 리소스에 대한 접근을 제어할 수 있는 기능도 제공하고 있습니다. 이렇게 많은 기능을 제공하고 있는 쿠버네티는 어떤 구조로 이루어져 있을까요?


### 쿠버네티스의 주요 구성요소
![쿠버네티스 아키텍처](/assets/img/k8s/k8s-01.PNG){: width="600" height="400"}


쿠버네티스(이하 k8s)의 주요 구성요소는 위와 같습니다. k8s 클러스터의 노드는 크게 마스터 노드와 워커 노드로 나뉩니다. 마스터 노드에는 k8s를 제어하는데 필요한 여러 컴포넌트들(apiserver, etcd, kube-scheduler 등) 이 모여 있습니다. 이를 컨트롤 플레인 컴포넌트라고 부릅니다. 마스터 노드에서는 일반적으로 사용자가 생성 요청한 파드가 생성되지는 않습니다. 사용자가 생성 요청한 파드는 워커 노드에 생성되는데 워커 노드에 각각 설치되어 있는 kubelet이라는 에이전트가 파드의 실제 생성과 동작을 관리하게 됩니다. 주요 구성요소에 대한 기능을 간략하게 정리하면 아래와 같습니다.

- kube-apiserver: 쿠버네티스 API를 사용할 수 있도록 노출합니다. 쿠버네티스에 보내는 모든 요청은 kube-apiserver를 통해 다른 컴포넌트로 전달 됩니다.
- etcd: 코어 OS에서 개발한 고가용성 키-값 저장소입니다. 클러스터 데이터에 대한 백업 저장소로 사용됩니다.
- kube-scheduler: 노드를 모니터링하고 생성된 Pod를 실행할 노드를 선택합니다. 현재 클러스터 안에서 자원 할당이 가능한 노드를 선택하여 새로운 파드를 실행합니다.
- kube-controller-manager: 컨트롤러를 제어하는 역할을 수행합니다.
- cloud-controller-manager: 쿠버네티스의 컨트롤러들을 클라우드 서비스와 연결해 관리하는 컴포넌트입니다. 
- kubelet: 워커 노드에서 실행되는 에이전트로써, 파드 컨테이너들의 실행을 직접 관리합니다.
- kube-proxy: 클러스터 내의 가상 네트워크를 설정하고 관리하는 역할을 합니다. 
- container runtime: 실제 컨테이너를 실행시키는 역할을 합니다. 주요 런타임으로는 docker, containerd, runc 등이 있습니다. 


### 주요 오브젝트 이해하기
쿠버네티스에는 위에서 설명한 다양한 기능을 제공해 주기 위해 여러가지 기본 오브젝트들이 존재합니다. 오브젝트란 쿠버네티스의 가장 기본 구성단위 입니다. 오브젝트는 각각의 특성을 지정한 오브젝트 스펙으로 기술되고 이 스펙을 기준으로 생성됩니다. 지금부터 주요 오브젝트들에 대해 간단하게 알아봅시다. 

1) 네임스페이스(Namespace)
네임스페이스는 클러스터 내부를 논리적으로 구분해 놓은 것을 말합니다. 사용자 또는 앱별로 네임스페이스를 분리함으로써 좀 더 세세한 관리가 가능합니다. 또한 네임스페이스 별로 클러스터 자원의 할당량도 조절할 수 있습니다. 

2) 파드(Pod)
하나 이상의 컨테이너로 이루어진 컨테이너 그룹을 말합니다. 쿠버네티스의 가장 작은 배포 단위로, 강한 결합을 유지해야 하는 컨테이너들을 묶어서 하나의 파드로 배포를 할 수 있지만 특별한 경우가 아니라면 보통 하나의 파드에는 하나의 사용자 컨테이너를 띄우도록 합니다. 사용자가 생성한 파드는 기본적으로 워커 노드에 생성됩니다. 

3) 서비스(Service) 
서비스에 대한 경로나 서비스 디스커버리를 제공하는 오브젝트 입니다. 기본적으로 파드는 생성 시, 동적으로 IP가 할당됩니다. 그래서 파드가 재생성될 때 IP가 변경되는 문제가 있습니다. 서비스를 생성하고 이를 파드와 연결시키면 고정된 주소를 이용하여 파드에 접근할 수 있습니다.  

4) 볼륨(Volume)
기본적으로 파드는 컨테이너가 삭제되거나 재실행될 때 데이터를 저장하지 않습니다. 하지만 볼륨을 사용하면 컨테이너를 재시작하더라도 데이터를 유지할 수 있습니다. 볼륨을 통해 파드가 생성된 호스트의 디스크를 볼륨으로 사용하거나 glusterfs나 cephfs 등 여러 스토리지 서비스가 관리하는 디스크를 볼륨으로 사용할 수 있습니다. 


이 외에도 다양한 오브젝트들이 존재하는데, 더 상세한 내용은 다음 포스팅을 통해서 알아보도록 하겠습니다.

### 참고자료
- [https://kubernetes.io/ko/docs/concepts/overview/](https://kubernetes.io/ko/docs/concepts/overview/)
- [https://bcho.tistory.com/1256](https://bcho.tistory.com/1256)
- 쿠버네티스 입문[정원청 외 지음, 동양북스]