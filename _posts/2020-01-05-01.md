---
layout: post
title: 'Pod에 대해 알아보자'
subtitle: ''
categories: kubernetes
comments: false
---

### 파드란 무엇일까요?
파드는 쿠버네티스에 의해 관리 되는 컨테이너들의 묶음입니다. 사용자가 만든 앱을 배포할 때 최소단위가 되며 쿠버네티스에서는 파드를 관리하는 여러 컨트롤러들을 제공해줌으로써 파드를 다양한 목적에 맞게 배포하고 관리할 수 있게 하고 있습니다. 

기본적으로 하나의 파드에는 여러 컨테이너들을 포함시킬 수 있습니다. 그리고 하나의 파드에 있는 컨테이너들은 파드에 동적으로 할당된 동일한 IP주소를 공유하게 됩니다. 파드 내의 컨테이너들끼리 통신해야 한다면 컨테이너별로 할당된 포트를 통해 서로를 구분할 수 있습니다. 

하지만 일반적으로는 파드 하나에 사용자 앱 컨테이너 하나만을 포함시킵니다. 만약 컨테이너끼리 동일한 생명주기와 강합 결합이 필요로 하는 경우, 예를 들어 특정 애플리케이션의 로그 처리를 도맡아 하는 서비스가 따로 존재한면 해당 컨테이너들은 같은 파드에 띄워서 관리하는 편이 효율적일 수 있습니다.

### 파드를 생성해 보자
파드를 생성하는 기본 스펙은 아래와 같습니다. 
```
apiVersion: v1
kind: Pod
metadata:
  name: hello
  labels:
     app: pod
spec:
  containers:
  - name: hello
    image: busybox
    ports:
    - containerPort: 8080
```
일단 kind 필드에 생성하려는 오브젝트의 종류를 지정해주고 metadata 항목을 채워줍니다. metadta.name는 파드의 이름을 나타내고 metadata.labels는 추후 다른 오브젝트들과 연결을 위해 필요한 항목입니다.
그리고 spec을 지정해 주는데 spec에는 컨테이너를 생성하는데 필요한 기본 정보를 포함하게 됩니다. 이 외에도 환경변수 설정, 실행 커맨드 지정 등 다양한 항목이 존재하며 상황에 맞는 필드 속성을 사용하시면 됩니다. 자세한 내용은 [쿠버네티스 API 문서](https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.19)를 확인해 보시면 됩니다. 

이렇게 작성한 스펙을 쿠버네티스 마스터 노드에 pod.yml 파일로 저장합니다. 그리고 kubectl이라는 cli 도구에서 제공하는 apply 명령어를 통해 yml을 실행합니다. 
```
kubectl apply -f pod.yml
```
그리고 생성된 파드의 목록을 확인해 보려면 아래 명령어를 실행합니다. 
```
kubectl get pods -A
```
kubectl에 대한 사용법은 [kubectl 문서](https://kubernetes.io/docs/reference/kubectl/overview/)를 확인해 보시기 바랍니다. 

### 파드의 생명주기
파드에는 일련의 생명주기가 존재합니다. 그 단계는 아래와 같습니다.

- Pending: 파드를 생성하고 있는 중인 단계입니다.
- Running: 파드의 컨테이너가 모두 생성된 상태로 하나 이상의 컨테이너가 실행 중 혹은 재시작 상태일 수 있습니다. 
- Succeeded: 파드 안의 모든 컨테이너가 실행 후 정상 종료된 상태입니다. 
- Failed: 파드의 컨테이너 중에 비정상적으로 종료된 컨테이너가 하나 이상 존재하는 상태입니다.
- Unknown: 통신이 끊어지는 등의 이유로 파드의 상태를 확인할 수 없는 경우입니다.

kubectl(cli 도구)의 describe 명령어로 각 파드의 상세한 상태를 확인할 수 있습니다. 
```
kubectl describe pods <파드명>
```

파드의 상태 확인 시에는 한가지 주의해야 할 부분이 있습니다. 파드의 Running 상태가 컨테이너 혹은 애플리케이션이 정상동작 중임을 표시하는 건 아니라는 겁니다. 파드가 Running 이더라도 컨테이너가 재시작하고 있는 상태일 수도 있고, 컨테이너가 정상적이더라도 실제 애플리케이션에 문제가 발생한 경우가 있을 수도 있습니다. 예를 들어, 컨테이너 내의 WAS는 정상동작 중이더라도 애플리케이션에 어떤 익셉션이 발생하는 경우 파드의 상태는 Running으로 표시되게 됩니다. 그러므로 애플리케이션의 동작여부를 정확히 파악하기 위해서는 파드, 컨테이너, 애플리케이션의 각 상태를 함께 파악하여야 합니다. 

### pause 컨테이너
위에서 파드 내의 컨테이너들은 동일한 IP주소를 공유한다고 하였습니다. 어떻게 가능한 일일까요? 쿠버네티스 파드에는 자체적으로 포함되는 pause라는 컨테이너가 있습니다. pause는 PID가 1로 설정되고 다른 컨테이너들의 부모 역할을 하게 됩니다. 파드 생성 시, pause 컨테이너는 동적으로 IP 주소를 할당받게 되고 자식 컨테이너들은 pause가 제공하는 네트워크를 공유하여 사용하게 됩니다. 그래서 만약 사용자 앱 컨테이너가 재실행 된다고 하더라도 pause 컨테이너가 정상적으로 작동하게 되면 파드의 IP 주소는 유지됩니다. 하지만 그 반대의 경우라면 IP는 변경이 될 수 있습니다. 동적으로 변경되는 IP는 운영환경에서 관리하기 어려우므로 쿠버네티스는 서비스라는 오브젝트를 제공하여 고정된 IP 주소로 파드에 접근하는 방법을 제공해 주고 있습니다. 

파드에 대한 더 자세한 내용은 다음에 또 알아보도록 하겠습니다. 


### 참고자료
- [https://kubernetes.io/ko/docs/concepts/workloads/pods/](https://kubernetes.io/ko/docs/concepts/workloads/pods/)
- [https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.19](https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.19)
- 쿠버네티스 입문[정원천 외 지음, 동양북스]