---
layout: post
title: '카프카의 기본 개념에 대해 한번 알아보자'
categories: kafka
comments: false
---

### 카프카란 무엇일까요?
카프카는 대규모 메시지를 빠르게 처리하기 위해서 링크드인이라는 회사에서 개발한 메시징 플랫폼입니다. 링크드인은 카프카 개발을 통해 기존에 난잡하게 얽혀있던 서비스의 시스템의 구조를 단순하게 하면서도 빠른 처리를 제공하고, 여러 타 시스템들과 효율적으로 연동할 수 있는 시스템을 구축할 수 있었습니다. 기존의 메시지큐 시스템들이 제공해주는 신뢰성에 더하여 더 빠른 처리 능력은 요즘 같이 대용량 데이터의 핸들링이 중요해진 빅데이터 시대에 안성맞춤이었습니다. 
그러면 지금부터 카프카의 주요 구성요소와 특징에 대해 알아보도록 하겠습니다. 

### 프로듀서와 컨슈머
카프카는 Pub/Sub 구조로 이루어진 메시징 시스템입니다. 메시지를 생산하는 주체를 프로듀서라고 하고 이 메시지를 소비하는 주체를 컨슈머라고 합니다. 프로듀서가 특정 토픽(topic)에다가 메시지를 발행하면 이를 구독하고 있는 컨슈머가 이 메시지를 받아서 처리하게 됩니다. 그런데 여기서 말하는 토픽이란 무엇일까요?<br/>
토픽이란 메시지를 구분하기 위한 일종의 태그 같은 것입니다. (이해하기 쉽도록 태그라는 표현을 사용)<br/> 토픽을 기준으로 메시지는 카테고리화 됩니다. 프로듀서는 메시지의 소비자가 누군지 몰라도 상관없습니다. 특정 토픽에 메시지를 발행하게 되면 실제 그 메시지를 처리하는 소비자는 해당 토픽을 구독하기만 하면 메시지를 받을 수 있습니다. 물론 소비자의 경우에도 발행자가 누군지 알 필요는 없습니다. <br/>
카프카에서 토픽은 아주 중요한 개념이므로 여기에 대해서 좀 더 알아보겠습니다. 

### 토픽은 파티션으로 나뉜다
파티션은 하나의 토픽을 여러 개로 분리해 놓은 것이라고 할 수 있습니다. 각각의  파티션은 큐와 같아서 특정 토픽에 대한 메시지가 들어오는 순서대로 담겨 있고 파티션과 연결된 컨슈머가 이를 차례로 가져가서 처리하게 됩니다.

![파티션](/assets/img/kafka/kafka-01.png) 

그렇다면 파티션은 왜 나눠져 있을까요? 메시지가 빠른 속도로 쌓여가는 환경에서 메시지에 대한 처리를 빠르게 하기 위해서 입니다. 파티션이 나눠져 있으면 메시지 처리를 병렬적으로 수행할 수 있습니다. 각 파티션을 담당하는 컨슈머가 개별적으로 동작하여 처리 속도를 높이는 것이죠. 하나의 파티션은 오직 하나의 컨슈머와만 연결될 수 있는데, 이미 처리된 메시지가 중복 처리되는 것을 막기 위해서 입니다. <br/>
그런데 속도가 빠르다고 해서 무조건 파티션을 나누는게 좋은 것은 아닙니다. 일단 메시지가 생성되는 순서로 메시지가 처리되지는 않습니다. 파티션 별로 병렬적으로 메시지를 처리하기 때문인데요, 만약 메시지가 생성된 순서로 처리되어야 함을 보장해야 한다면 반드시 파티션을 하나만 생성해야 합니다. <br/>
그리고 파티션은 그 자체로 리소스를 소비하게 되는데 운영 중에 한번 늘린 파티션은 다시 줄일 수 없기 때문에 파티션의 수를 늘릴 때는 충분히 고려하는 시간이 필요합니다. 

### 하나 더, 컨슈머 그룹이란?
위에서 파티션은 컨슈머 그룹 내 하나의 컨슈머와만 연결될 수 있다고 했는데, 컨슈머 그룹이란 말 그대로 컨슈머들의 집합이라고 할 수 있습니다. 그렇다면 컨슈머 그룹은 왜 존재하는 것일까요? 그 이유는 메시지 처리에 대한 고가용성을 보장하기 위해서 입니다. 만약 특정 파티션을 담당하고 있던 컨슈머에 오류가 생겨서 메시지를 처리할 수 없는 상황이 온다면, 그룹 내의 다른 컨슈머가 해당 파티션을 넘겨받아 메시지 처리를 이어서 진행하게 됩니다. 이를 리밸런스라고 하는데 이것이 가능한 이유는 각 파티션의 offset 정보(메시지가 어디까지 처리되었는지에 대한 위치 정보)를 그룹 내에서 공유가 되기 때문입니다.

### 카프카의 주 사용처
카프카는 주로 대규모 데이터를 처리하는 분산환경이나 구조적으로 엄청나게 복잡한 환경의 아키텍처를 단순하게 통일시키고자 하는 곳에서 사용할 수 있습니다. 
<br/>
<br/>
지금까지 간략하게 카프카의 기본 개념에 대해 알아보았습니다. 다음에는 카프카의 구축 방법과 좀 더 상세한 동작 방식에 대해 한번 알아보도록 하겠습니다. 

### 참고자료
- 카프카, 데이터 플랫폼의 최강자[고승범/공용준 지음, 책만]
